<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <title>employees.jsp</title>
    <meta charset="utf-8">
    <base href="/merise/" />
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="stylesheet" href="easyui/themes/default/easyui.css" />
	<link rel="stylesheet" href="easyui/themes/icon.css" />
	<script type="text/javascript" src="easyui/jquery.min.js"></script>
	<script type="text/javascript" src="easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="easyui/locale/easyui-lang-zh_CN.js"></script>
	<script type="text/javascript" src="static/layer/layer.js"></script>
	<script type="text/javascript" src="easyui/ifmtech.easyui.extend.js"></script>
  </head>
  
  <body style="margin: 0; padding: 0;">
  	<div id="treeBox" style="float: left;width: auto;">
  		<ul id="tree"></ul>
  	</div>
  	
  	<div id="contextBox" style="float: right; display: none;">
	  	<table id="dg" title="员工信息列表" class="easyui-datagrid" style="min-height: 100vh;"
	  		toolbar="#toolbar" pagination="true"
	  		rownumbers="true" fitColumns="true" singleSelect="true">
	  		<thead>
	  			<tr>
	  			
	  			</tr>
	  		</thead>
	  	</table>
	  	<div id="toolbar">
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" plain="true" id="new">新增</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true" id="edit">修改</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" id="delete">删除</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cologne-star" plain="true" id="detail">详情</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cologne-advertising" plain="true" id="event">事件明细</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cologne-communication" plain="true" id="gwbd">岗位变动</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cologne-invoice" plain="true" id="xzbd">薪资变动</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cologne-featured" plain="true" id="htgx">合同更新</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cologne-order-1" plain="true" id="kh">考核</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cologne-user" plain="true" id="bindingUser">绑定APP用户</a>
	        <input id="ss" class="easyui-searchbox"  searcher="doSearch"  prompt="请输入员工编号或姓名或岗位"   style="width:190px; vertical-align: middle;"/>
	    </div>
	  	<div id="dlg" class="easyui-dialog" style="width:600px; height:500px;" closed="true" buttons="#dlg-buttons">
		  	<form id="fm" method="post" novalidate style="margin:0;padding:15px 10px">
		  		<input type="hidden" name="building_id" id="building_id">
		  		<table cellpadding="5" style="width: 100%">
		  			<tr>
	    				<td style="text-align: right;">员工姓名:</td>
	    				<td><input name="employees_name" class="easyui-textbox" required="true"  style="width: 180px;"></td>
	               		<td style="text-align: right;">出生日期:</td>
	    				<td><input class="easyui-datebox" name="birthday_value" id="birthday" labelPosition="top" required="true"  style="width: 180px;"></td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">身份证号:</td>
	    				<td><input name="id_number" class="easyui-textbox" required="true" style="width: 180px;"></td>
	    				<td style="text-align: right;">员工性别:</td>
	    				<td>男<input type="radio" name="employees_sex" value="0" checked="checked"/>
	               			女<input type="radio" name="employees_sex" value="1"/>
	               		</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">员工手机号:</td>
	    				<td><input name="employees_phone" class="easyui-textbox" required="true" style="width: 180px;"></td>
	               		<td style="text-align: right;">薪资:</td>
	    				<td><input name="salary" class="easyui-textbox" required="true" style="width: 180px;"></td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">部门:</td>
	    				<td><select name="employees_dept"  id="deptCombobox" required="true" style="width: 180px;"></select></td>
	               		<td style="text-align: right;">岗位:</td>
	    				<td><input name="employees_job" class="easyui-textbox" required="true" style="width: 180px;"></td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">入职时间:</td>
	    				<td><input class="easyui-datebox" name="induction_time_value" required="true"  id="induction_time" labelPosition="top" style="width: 180px;"></td>
	               		<td style="text-align: right;">合同起始日期:</td>
	    				<td><input class="easyui-datebox" name="contract_start_value" id="contract_start" labelPosition="top" required="true"  style="width: 180px;"></td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">合同终止日期:</td>
	    				<td><input class="easyui-datebox" name="contract_end_value" id="contract_end" labelPosition="top" required="true" style="width: 180px;"></td>
	               		<td style="text-align: right;">员工学历:</td>
	    				<td><input name="employees_education" class="easyui-textbox" required="true" style="width: 180px;"></td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">毕业院校:</td>
	    				<td><input name="graduate_school" class="easyui-textbox" required="true" style="width: 180px;"></td>
	               		<td style="text-align: right;">是否转正:</td>
	    				<td>
	    					是<input type="radio" name="is_positive" value="0" checked="checked"/>
	               			否<input type="radio" name="is_positive" value="1"/>
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">就职状态:</td>
	    				<td>
	    					是<input type="radio" name="office_status" value="0" checked="checked"/>
	               			否<input type="radio" name="office_status" value="1"/>
	    				</td>
	               		<td style="text-align: right;">离职时间:</td>
	    				<td>
	    					<input class="easyui-datebox" name="departure_time_value" id="departure_time" labelPosition="top" style="width: 180px;">
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">QQ:</td>
	    				<td><input name="qq" class="easyui-textbox" label="" style="width: 180px;"></td>
	               		<td style="text-align: right;">居住地址:</td>
	    				<td>
	    					<input name="live_addr" class="easyui-textbox" required="true" style="width: 180px;">
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">微信:</td>
	    				<td><input name="employees_wechat" class="easyui-textbox" style="width: 180px;"></td>
	               		<td style="text-align: right;">邮箱:</td>
	    				<td>
	    					<input name="employees_email" class="easyui-textbox"  style="width: 180px;">
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">备注:</td>
	    				<td colspan="3">
	    					<textarea rows="3" cols="25" name="employees_remark" class="textarea easyui-validatebox" style="width: 100%;resize:none;"></textarea>
	    				</td>
	    			</tr>
		  		</table>
		  	</form>
		  	
		  	<div id="dlg-buttons">
		        <a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" id="save" style="width:90px">保存</a>
		        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')" style="width:90px">取消</a>
		    </div>
	  	</div>
	    <!-- 详情 -->
	    <div id="dlg1" class="easyui-dialog" style="width:600px;height:500px;" closed="true" buttons="#dlg1-buttons">
	     	<form id="fm1" method="post" novalidate style="margin:0;padding:15px 10px">
	            <table cellpadding="5" style="width: 100%">
	            	<tr>
	    				<td style="text-align: right;">员工姓名:</td>
	    				<td><input name="employees_name" class="easyui-textbox" required="true" label="员工姓名:" style="width: 180px;"></td>
	               		<td style="text-align: right;">员工性别:</td>
	    				<td>
	    					男<input type="radio" name="employees_sex" value="0" checked="checked" disabled="disabled"/>
	               			女<input type="radio" name="employees_sex" value="1" disabled="disabled"/>
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">身份证号:</td>
	    				<td><input name="id_number" class="easyui-textbox" required="true" style="width: 180px;" disabled="disabled"></td>
	               		<td style="text-align: right;">出生日期:</td>
	    				<td>
	    					<input class="easyui-datebox" name="birthday_value" id="birthday1" labelPosition="top" required="true"  style="width: 180px;" disabled="disabled">
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">员工手机号:</td>
	    				<td><input name="employees_phone" class="easyui-textbox" required="true" style="width: 180px;" disabled="disabled"></td>
	               		<td style="text-align: right;">薪资:</td>
	    				<td>
	    					<input name="salary" class="easyui-textbox" required="true" style="width: 180px;" disabled="disabled">
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">部门:</td>
	    				<td><select name="employees_dept"  id="deptCombobox1" style="width: 180px;" required="true" disabled="disabled"></select></td>
	               		<td style="text-align: right;">岗位:</td>
	    				<td>
	    					<input name="employees_job" class="easyui-textbox" required="true" style="width: 180px;" disabled="disabled">
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">入职时间:</td>
	    				<td><input class="easyui-datebox" required="true"  id="induction_time1" labelPosition="top" style="width: 180px;" disabled="disabled"></td>
	               		<td style="text-align: right;">合同起始日期:</td>
	    				<td>
	    					<input class="easyui-datebox" id="contract_start1" labelPosition="top" required="true"  style="width: 180px;" disabled="disabled">
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">合同终止日期:</td>
	    				<td><input class="easyui-datebox" id="contract_end1" labelPosition="top" required="true"  style="width: 180px;" disabled="disabled"></td>
	               		<td style="text-align: right;">员工学历:</td>
	    				<td>
	    					<input name="employees_education" class="easyui-textbox" required="true" style="width: 180px;" disabled="disabled">
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">毕业院校:</td>
	    				<td><input name="graduate_school" class="easyui-textbox" required="true" style="width: 180px;" disabled="disabled"></td>
	               		<td style="text-align: right;">是否转正:</td>
	    				<td>
	    					是<input type="radio" name="is_positive" value="0" checked="checked" disabled="disabled"/>
	               			否<input type="radio" name="is_positive" value="1" disabled="disabled"/>
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">就职状态:</td>
	    				<td>
	    					是<input type="radio" name="office_status" value="0" checked="checked" disabled="disabled"/>
	               		 	否<input type="radio" name="office_status" value="1" disabled="disabled"/>
	    				</td>
	               		<td style="text-align: right;">离职时间:</td>
	    				<td>
	    					<input class="easyui-datebox" name="departure_time_value" id="departure_time1" labelPosition="top" style="width: 180px;" disabled="disabled">
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">QQ:</td>
	    				<td>
	    					<input name="qq" class="easyui-textbox" style="width: 180px;" disabled="disabled">
	    				</td>
	               		<td style="text-align: right;">居住地址:</td>
	    				<td>
	    					<input name="live_addr" class="easyui-textbox" required="true" style="width: 180px;" disabled="disabled">
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">微信:</td>
	    				<td>
	    					<input name="employees_wechat" class="easyui-textbox" style="width: 180px;" disabled="disabled">
	    				</td>
	               		<td style="text-align: right;">邮箱:</td>
	    				<td>
	    					<input name="employees_email" class="easyui-textbox"  style="width: 180px;" disabled="disabled">
	    				</td>
	    			</tr>
	    			<tr>
	    				<td style="text-align: right;">备注:</td>
	    				<td colspan="3">
	    					<textarea rows="5" cols="25" name="employees_remark" class="textarea easyui-validatebox" style="width: 100%;resize:none;"></textarea>
	    				</td>
	    			</tr>
	            </table>
	        </form>
	        <div id="dlg1-buttons">
		        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg1').dialog('close')" style="width:90px">取消</a>
		    </div>
	    </div>
    
    	 <div id="dlg2" class="easyui-dialog" style="width:400px;height:500px;" closed="true" buttons="#dlg2-buttons">
	     	<form id="fm2" method="post" novalidate style="margin:0;padding:20px 50px">
	            <div style="margin-bottom:20px;font-size:14px;border-bottom:1px solid #ccc">岗位变动信息</div>
	             <div style="margin-bottom:10px">
	             	<input type="hidden" name="employees_id_value" id="employees_id_value">
	             	<input type="hidden" name="employees_dept_value" id="employees_dept_value">
	             	<input type="hidden" name="employees_job_value" id="employees_job_value">
	                <input name="employees_id"  class="easyui-textbox" required="true" label="员工编号:" style="width:100%" disabled="disabled">
	            </div>
	            <div style="margin-bottom:10px">
	                <input name="employees_name" class="easyui-textbox" required="true" label="员工姓名:" style="width:100%" disabled="disabled">
	            </div>
	            <div style="margin-bottom:10px">
	                <input name="employees_dept_text" class="easyui-textbox"  required="true" label="原部门:" style="width:100%" disabled="disabled">
	            </div>
	             <div style="margin-bottom:10px">
	                <input name="employees_job" class="easyui-textbox"  required="true" label="原岗位:" style="width:100%" disabled="disabled">
	            </div>
	            <div style="margin-bottom:10px">
	            	<label class="textbox-label textbox-label-before" style="text-align: left; height: 24px; line-height: 24px;">新部门:</label>
		           	<select name="new_dept"  id="deptCombobox2" style="width:68%" required="true" ></select>
	            </div>
	            <div style="margin-bottom:10px">
	           		<input name="new_job" class="easyui-textbox" required="true" label="新岗位:" style="width:100%" >
	            </div>
	            <div style="margin-bottom:10px">
            		<select name="remark" id="remarkAllCombobox" data-options="editable:false" style="width:100%;" required="true" label="变动信息:" ></select>
            	</div>
	            <div style="margin-bottom:10px">
	            	<div style="float: left;width: 80px;padding-right:5px;">原因:</div>
	            	<div style="float: left;">
		                <textarea  rows="5" cols="32" name="reason"  required="true"  class="textarea easyui-validatebox" ></textarea>
	            	</div>
	            </div>
	            
	        </form>
	    </div>
	    <div id="dlg2-buttons">
	    	<a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" id="savejob" style="width:90px">保存</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg2').dialog('close')" style="width:90px">取消</a>
	    </div>
	    
	    
	    <div id="dlg4" class="easyui-dialog" style="width:400px" closed="true" buttons="#dlg4-buttons">
	     	<form id="fm4" method="post" novalidate style="margin:0;padding:20px 50px">
	            <div style="margin-bottom:20px;font-size:14px;border-bottom:1px solid #ccc">薪资变动信息</div>
	             <div style="margin-bottom:10px">
	             	<input type="hidden" name="old_employees_id_value" id="old_employees_id_value">
	             	<input type="hidden" name="old_salary_value" id="salary_value">
	                <input name="employees_id"  class="easyui-textbox" required="true" label="员工编号:" style="width:100%" disabled="disabled">
	            </div>
	            <div style="margin-bottom:10px">
	                <input name="employees_name" class="easyui-textbox" required="true" label="员工姓名:" style="width:100%" disabled="disabled">
	            </div>
	            <div style="margin-bottom:10px">
	                <input name="salary" class="easyui-textbox"  required="true" label="原薪资:" style="width:100%" disabled="disabled">
	            </div>
	             <div style="margin-bottom:10px">
	                <input name="new_salary" class="easyui-textbox"  required="true" label="变更薪资:" style="width:100%">
	            </div>
	            <div style="margin-bottom:10px">
	            	<div style="float: left;width: 80px;padding-right:5px;">原因:</div>
	            	<div style="float: left;">
		                <textarea  rows="5" cols="25" name="reason"  required="true"  class="textarea easyui-validatebox" ></textarea>
	            	</div>
	            </div>
	        </form>
	    </div>
	    <div id="dlg4-buttons">
	    	<a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" id="saveSalary" style="width:90px">保存</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg4').dialog('close')" style="width:90px">取消</a>
	    </div>
	    
	    
	    <div id="dlg5" class="easyui-dialog" style="width:400px" closed="true" buttons="#dlg5-buttons">
	     	<form id="fm5" method="post" novalidate style="margin:0;padding:20px 50px">
	            <div style="margin-bottom:20px;font-size:14px;border-bottom:1px solid #ccc">合同更新信息</div>
	             <div style="margin-bottom:10px">
	             	<input type="hidden" name="old_employees_id" id="contract_employees_id">
	                <input name="employees_id"  class="easyui-textbox" required="true" label="员工编号:" style="width:100%" disabled="disabled">
	            </div>
	            <div style="margin-bottom:10px">
	                <input name="employees_name" class="easyui-textbox" required="true" label="员工姓名:" style="width:100%" disabled="disabled">
	            </div>
	            <div style="margin-bottom:10px">
	                <label class="textbox-label textbox-label-before" style="text-align: left; height: 24px; line-height: 24px;">签订日期:</label>
					<input class="easyui-datebox" name="signed_time"  labelPosition="top" required="true"  style="width:50%;">
	            </div>
	             <div style="margin-bottom:10px">
	                <input name="contract_status" class="easyui-textbox"  required="true" label="合同状态:" style="width:100%">
	            </div>
	            <div style="margin-bottom:10px">
	                <label class="textbox-label textbox-label-before" style="text-align: left; height: 24px; line-height: 24px;">合同起始日期:</label>
					<input class="easyui-datebox" name="contract_start_value" labelPosition="top" required="true"  style="width:50%;">
	            </div>
	            <div style="margin-bottom:10px">
	            	<label class="textbox-label textbox-label-before" style="text-align: left; height: 24px; line-height: 24px;">合同终止日期</label>
					<input class="easyui-datebox" name="contract_end_value"  labelPosition="top" required="true"  style="width:50%;">
	            </div>
	            <div style="margin-bottom:10px">
	            	<div style="float: left;width: 80px;padding-right:5px;">原因:</div>
	            	<div style="float: left;">
		                <textarea  rows="5" cols="25" name="reason"  required="true"  class="textarea easyui-validatebox" ></textarea>
	            	</div>
	            </div>
	        </form>
	    </div>
	    <div id="dlg5-buttons">
	    	<a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" id="saveContractChange" style="width:90px">保存</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg5').dialog('close')" style="width:90px">取消</a>
	    </div>
	    
	    
	    <div id="dlg6" class="easyui-dialog" style="width:400px" closed="true" buttons="#dlg6-buttons">
	     	<form id="fm6" method="post" novalidate style="margin:0;padding:20px 50px">
	            <div style="margin-bottom:20px;font-size:14px;border-bottom:1px solid #ccc">考核信息</div>
	             <div style="margin-bottom:10px">
	             	<input type="hidden" name="old_employees_id" id="check_employees_id">
	                <input name="employees_id"  class="easyui-textbox" required="true" label="员工编号:" style="width:100%" disabled="disabled">
	            </div>
	            <div style="margin-bottom:10px">
	                <input name="employees_name" class="easyui-textbox" required="true" label="员工姓名:" style="width:100%" disabled="disabled">
	            </div>
	            <div style="margin-bottom:10px">
	                <label class="textbox-label textbox-label-before" style="text-align: left; height: 24px; line-height: 24px;">考核日期:</label>
					<input class="easyui-datebox" name="check_time"  labelPosition="top" required="true"  style="width:50%;">
	            </div>
	            <div style="margin-bottom:10px">
	            	<div style="float: left;width: 80px;padding-right:5px;">考核内容:</div>
	            	<div style="float: left;">
		                <textarea  rows="5" cols="25" name="checkContext"  required="true"  class="textarea easyui-validatebox" ></textarea>
	            	</div>
	            </div>
	            <div style="margin-bottom:10px">
	                <input name="checkResult" class="easyui-textbox"  required="true" label="考核结果:" style="width:100%">
	            </div>
	        </form>
	    </div>
	    <div id="dlg6-buttons">
	    	<a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" id="saveCheck" style="width:90px">保存</a>
	        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg6').dialog('close')" style="width:90px">取消</a>
	    </div>
    </div>
    
    <div id="bindingDig" class="easyui-dialog" style="width:400px" closed="true" buttons="#bindingDig-buttons">
     	<form id="fmbinding" method="post" novalidate style="margin:0;padding:20px 50px">
     		<div style="margin-bottom:10px">
    			<select id="mobileSelect" class="easyui-combobox" required="true" label="手机号码选择:" style="width:100%"></select>
    		</div>
        </form>
    </div>
    <div id="bindingDig-buttons">
    	<a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" id="bindingSave" style="width:90px">保存</a>
        <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#bindingDig').dialog('close')" style="width:90px">取消</a>
    </div>
    
    <!-- 事件明细 -->
    <div id="dlg3" class="easyui-dialog" closed="true" >
        <form id="fm3" method="post" novalidate style="margin:0;">
            <table id="tt3" style="width:600px;height:370px"  singleSelect="true" >
	            <select  style="width:150px" class="easyui-combobox" id="eventName">
	            	<option value="">请选择事件名称</option>
	            	<option value="岗位变动">岗位变动</option>
	            	<option value="薪资变动">薪资变动</option>
	            	<option value="合同更新">合同更新</option>
	            	<option value="考核">考核</option>
	            	<option value="面试记录">面试记录</option>
	            	<option value="培训">培训</option>
	            </select>
	            <a href="javascript:void(0)" class="easyui-linkbutton c6"  onclick="doSearchEvent()" style="width:50px">查询</a>
			</table>
        </form>
    </div>
    <script type="text/javascript">
    var estate_id="";
    var building_id="";
    //实例化树菜单  
	 $(function(){
		 $("#tree").tree({  
		     url:'employees/tree',//请求路径，id为根节点的id  
		     onClick: function(node){
		    	 building_id = node.id;//楼盘id
				 if (node.attributes.level == "build") {
			    	estate_id=$(this).tree("getParent",node.target).id;
					$("#contextBox").width($(document.body).width() - $("#treeBox").width() - 10);
					$("#contextBox").show();
		    		 //根据左边栋跟楼盘查询所有业主
		    		 $("#dg").datagrid({
	        			remoteSort:false,
	        			nowrap:false,
	        			pagination: true, //显示分页
	                    pageSize: 10, //页大小
	                    pageList: [10, 20, 30, 40, 50], //页大小下拉选项此项各value是pageSize的倍数
	        			url:'employees/findEmployeesByBuildingId?building_id='+building_id+'&n='+Math.random(),
	        			columns:[[
	        				{field:'employees_id',title:'员工编号',width:100,align:'center'},
	        				{field:'employees_name',title:'员工姓名',width:120,align:'center'},
	        				{field:'employees_sex',title:'员工性别',width:80,align:'center',formatter: function (date) {if(date==0){return '男';}else{return '女';}}},
	        				{field:'birthday',title:'出生日期',width:120,align:'center',formatter: function (date) {if(date!=null){return date.substring(0,10);}}},
	        				{field:'employees_dept',title:'部门编号',width:80,align:'center'},
	        				{field:'employees_dept_text',title:'部门名称',width:80,align:'center'},
	        				{field:'employees_job',title:'岗位',width:50,align:'center'},
	        				{field:'induction_time',title:'入职时间',width:120,align:'center',formatter: function (date) {if(date!=null){return date.substring(0,10);}}},
	        				{field:'contract_start',title:'合同起始日期',width:120,align:'center',formatter: function (date) {if(date!=null){return date.substring(0,10);}}},
	        				{field:'contract_end',title:'合同终止日期',width:120,align:'center',formatter: function (date) {if(date!=null){return date.substring(0,10);}}},
	        				{field:'employees_phone',title:'员工手机号',width:120,align:'center'},
	        				{field:'salary',title:'薪资',width:120,align:'center'},
	        				{field:'employees_education',title:'员工学历',width:120,align:'center'},
	        				{field:'graduate_school',title:'毕业院校',width:120,align:'center'},
	        				{field:'is_positive',title:'是否转正',width:120,align:'center',formatter: function (date) {if(date==0){return '是';}else if(date==1){return '否';}}},
	        				{field:'office_status',title:'就职状态',width:120,align:'center',formatter: function (date) {if(date==0){return '是';}else if(date==1){return '否';}}},
	        				{field:'departure_time',title:'离职时间',width:120,align:'center',formatter: function (date) {if(date!=null){return date.substring(0,10);}}},
	        				{field:'qq',title:'QQ',width:120,align:'center'},
	        				{field:'id_number',title:'身份证号',width:120,align:'center'},
	        				{field:'live_addr',title:'居住地址',width:120,align:'center'},
	        				{field:'employees_wechat',title:'微信',width:120,align:'center'},
	        				{field:'employees_email',title:'邮箱',width:120,align:'center'},
	        				{field:'employees_remark',title:'备注',width:120,align:'center'},
	        				{field:'building_id',title:'楼盘编号',width:120,align:'center'}
	        			]]
	        		});
		    		$("#dg").datagrid('hideColumn', 'live_addr');
		    		$("#dg").datagrid('hideColumn', 'employees_wechat');
		    		$("#dg").datagrid('hideColumn', 'employees_email');
		    		$("#dg").datagrid('hideColumn', 'employees_remark');
		    		$("#dg").datagrid('hideColumn', 'qq');
		    		$("#dg").datagrid('hideColumn', 'building_id');
		    		$("#dg").datagrid('hideColumn', 'graduate_school');
		    		$("#dg").datagrid('hideColumn', 'employees_education');
		    		$("#dg").datagrid('hideColumn', 'employees_dept');
		    		$("#dg").datagrid('hideColumn', 'id_number');
		    		$("#dg").datagrid('hideColumn', 'contract_start');
		    		$("#dg").datagrid('hideColumn', 'contract_end');
		    		$("#dg").datagrid('hideColumn', 'departure_time');
		    		$("#dg").datagrid('hideColumn', 'salary');
		    		$("#dg").datagrid('hideColumn', 'employees_id');
		         }else {
					$("#contextBox").hide();
				 }
	    	 }
		 }); 
	 });
    
    function doSearch(value){ //点击搜素,触发此函数
        $("#dg").datagrid({ 
            url:'employees/findEmployeesByBuildingId?searchValue='+value+"&building_id="+building_id, //触发此action,带上参数searcValue  
        });
    }  
    
    function doSearchEvent(){ //点击搜素,触发此函数
    	var row = $("#dg").datagrid("getSelected");
    	var value = $("#eventName").combobox("getValue");
        $("#tt3").datagrid({ 
            url:'employees/findEventByEmployeesId?searchValue='+value+'&employees_id='+row.employees_id, //触发此action,带上参数searcValue  
        });
    }

    $('#remarkAllCombobox').combobox({
   		url:'employees/getEventRemark',
   		valueField:'remark',
   		textField:'remarkValue'
   	});
    	var url;
    	$(document).on("click", "#new", function(){
    		 $("#dlg").dialog("open").dialog("center").dialog("setTitle","新建员工信息");
             $("#fm").form("clear");
             $("#building_id").val(building_id);
             $.ajax({
	             type: "POST",
	             url: 'estateCodeEetail/findByCodeNameAndBuildingId',
	             data: {code_name:"部门",building_id:building_id},
	             dataType: "json",
	             success: function(data){
	            	var html = "";
	            	$.each(data, function(commentIndex, comment){
                    	html += "<option value="+comment['code_id']+">"+comment['code_content']+"</option>"; 
                	});
	            	$("#deptCombobox").html("");
	            	$("#deptCombobox").append(html);
	             }
	          });
             
             url = "employees/save";
    	});
    	
    	
		$(document).on("click", "#edit", function(){
			var row = $("#dg").datagrid("getSelected");
            if (row){
                $("#dlg").dialog("open").dialog("center").dialog("setTitle","修改员工信息");
                $("#fm").form("load",row);
               //默认时间
               $('#induction_time').datebox('setValue', row.induction_time);	
               $('#departure_time').datebox('setValue', row.departure_time);	
               $('#contract_start').datebox('setValue', row.contract_start);	
               $('#contract_end').datebox('setValue', row.contract_end);	
               $('#birthday').datebox('setValue', row.birthday);	
               $("#building_id").val(building_id);
               $.ajax({
  	             type: "POST",
  	             url: 'estateCodeEetail/findByCodeNameAndBuildingId',
  	             data: {code_name:"部门",building_id:building_id},
  	             dataType: "json",
  	             success: function(data){
  	            	var html = "";
  	            	$.each(data, function(commentIndex, comment){
  	            		if(row.employees_dept == comment['code_id']){
                          	 html += "<option value="+comment['code_id']+" selected='selected'>"+comment['code_content']+"</option>";
                         }else{
                        	 html += "<option value="+comment['code_id']+">"+comment['code_content']+"</option>"; 
                         }
                  	});
  	            	$("#deptCombobox").html("");
  	            	$("#deptCombobox").append(html);
  	             }
  	          });
                url = "employees/edit?id="+row.employees_id;
            }
    	});
		
		$(document).on("click", "#delete", function(){
			var row = $("#dg").datagrid("getSelected");
            if (row){
                $.messager.confirm("Confirm","是否确认删除该员工?",function(r){
                    if (r){
                        $.post("employees/delete",{id:row.employees_id},function(result, status){
                        	
                        },"json");
                        $("#dg").datagrid("reload");
                    }
                });
            }
		});
		$(document).on("click", "#save", function(){
			$("#fm").form("submit",{
                url: url,
                onSubmit: function(){
                    return $(this).form("validate");
                },
                success: function(result){
                   $("#dlg").dialog("close");
                   $("#dg").datagrid("reload");
                }
            });
		});
		
		
		$(document).on("click", "#detail", function(){
			var row = $("#dg").datagrid("getSelected");
            if (row){
                $("#dlg1").dialog("open").dialog("center").dialog("setTitle","员工信息详情");
                $("#fm1").form("load",row);
               //默认时间
               $('#induction_time1').datebox('setValue', row.induction_time);	
               $('#departure_time1').datebox('setValue', row.departure_time);	
               $('#birthday1').datebox('setValue', row.birthday);	
               $('#contract_start1').datebox('setValue', row.contract_start);	
               $('#contract_end1').datebox('setValue', row.contract_end);	
               
               $("#deptCombobox1").html("");
               $("#deptCombobox1").html("<option selected='selected'>"+row.employees_dept_text+"</option>");
            }
    	});
		
		$(document).on("click", "#gwbd", function(){
			var row = $("#dg").datagrid("getSelected");
            if (row){
            	$("#dlg2").dialog("open").dialog("center").dialog("setTitle","岗位变动信息");
                $("#fm2").form("clear");
       		    $("#fm2").form("load",row);
       		    $("#employees_id_value").val(row.employees_id);
       		    $("#employees_dept_value").val(row.employees_dept_text);
       		    $("#employees_job_value").val(row.employees_job);
                url = "employees/jobchange";
	       		 $.ajax({
		             type: "POST",
		             url: 'estateCodeEetail/findByCodeNameAndBuildingId',
		             data: {code_name:"部门",building_id:building_id},
		             dataType: "json",
		             success: function(data){
		            	var html = "";
		            	$.each(data, function(commentIndex, comment){
	                    	html += "<option value="+comment['code_id']+">"+comment['code_content']+"</option>"; 
	                	});
		            	$("#deptCombobox2").html("");
		            	$("#deptCombobox2").append(html);
		             }
		          });
       		}
         });
		
		$(document).on("click", "#savejob", function(){
			$("#fm2").form("submit",{
                url: url,
                onSubmit: function(){
                    return $(this).form("validate");
                },
                success: function(result){
                   $("#dlg2").dialog("close");
                   $("#dg").datagrid("reload");
                }
            });
		});
		
		$(document).on("click","#bindingUser",function(){
			var row = $("#dg").datagrid("getSelected");
			if(row) {
				$("#bindingDig").dialog("open").dialog("center").dialog("setTitle","绑定APP用户");
				$("#mobileSelect").combobox({
		    		url:"employees/findUser",
		    		multiple:false,
		    		editable:true,
		    		valueField:"id",
		    		textField:"mobile"
		    	});
			}
		});
		
		//事件明细
		$(document).on("click", "#event", function(){
			var editRow = undefined; //定义全局变量：当前编辑的行
			var datagrid; //定义全局变量datagrid
			var row = $("#dg").datagrid("getSelected");
            if (row){
                $("#dlg3").dialog("open").dialog("center").dialog("setTitle","事件明细信息");
                $("#fm3").form("load",row);
                
                datagrid=$("#tt3").datagrid({
        			remoteSort:false,
        			singleSelect:true,
        			nowrap:false,
        			fitColumns:true,
        			pagination: true, //显示分页
                    pageSize: 10, //页大小
                    pageList: [10,15,20,25], //页大小下拉选项此项各value是pageSize的倍数
        			url:'employees/findEventByEmployeesId?employees_id='+row.employees_id,
        			columns:[[
        				{field:'event_id',title:'事件编号',width:50,align:'center'},
        				{field:'employees_id',title:'员工编号',width:50,align:'center', editor: { type: 'validatebox', options: { required: true} }},
        				{field:'employees_name',title:'员工名称',width:50,align:'center', editor: { type: 'validatebox', options: { required: true} }},
        				{field:'event_name',title:'事件名称',width:100,align:'center', editor: { type: 'validatebox', options: { required: true} }},
        				{field:'event_context',title:'事件内容',width:300,align:'center', editor: { type: 'validatebox', options: { required: true} }}
        			]],
        			onDblClickRow: function (rowIndex, rowData) {
        				editRow = undefined;
                        datagrid.datagrid("rejectChanges");
                        datagrid.datagrid("unselectAll");
                       //双击开启编辑行
                       if (editRow != undefined) {
                           datagrid.datagrid("endEdit", editRow);
                       }
                       if (editRow == undefined) {
                           datagrid.datagrid("beginEdit", rowIndex);
                           editRow = rowIndex;
                       }
                    },
                    onAfterEdit: function (rowIndex, rowData, changes) {
                        //endEdit该方法触发此事件
                        console.info(rowData);
                        editRow = undefined;
                    }
        		});
                
                $("#tt3").datagrid('hideColumn', 'employees_id');
                $("#tt3").datagrid('hideColumn', 'event_id');
            }
    	});
		
		$(document).on("click", "#xzbd", function(){
			var row = $("#dg").datagrid("getSelected");
            if (row){
            	$("#dlg4").dialog("open").dialog("center").dialog("setTitle","薪资变动信息");
                $("#fm4").form("clear");
       		    $("#fm4").form("load",row);
       		    $("#old_employees_id_value").val(row.employees_id);
       		    $("#salary_value").val(row.salary);
                url = "employees/salaryChange";
       		}
         });
		
		$(document).on("click", "#saveSalary", function(){
			$("#fm4").form("submit",{
                url: url,
                onSubmit: function(){
                    return $(this).form("validate");
                },
                success: function(result){
                   $("#dlg4").dialog("close");
                   $("#dg").datagrid("reload");
                }
            });
		});
		
		$(document).on("click", "#htgx", function(){
			var row = $("#dg").datagrid("getSelected");
            if (row){
            	$("#dlg5").dialog("open").dialog("center").dialog("setTitle","合同更新信息");
                $("#fm5").form("clear");
       		    $("#fm5").form("load",row);
       		    $("#contract_employees_id").val(row.employees_id);
                url = "employees/contractChange";
       		}
         });
		
		$(document).on("click", "#saveContractChange", function(){
			$("#fm5").form("submit",{
                url: url,
                onSubmit: function(){
                    return $(this).form("validate");
                },
                success: function(result){
                   $("#dlg5").dialog("close");
                   $("#dg").datagrid("reload");
                }
            });
		});
		
		
		$(document).on("click", "#kh", function(){
			var row = $("#dg").datagrid("getSelected");
            if (row){
            	$("#dlg6").dialog("open").dialog("center").dialog("setTitle","考核信息");
                $("#fm6").form("clear");
       		    $("#fm6").form("load",row);
       		    $("#check_employees_id").val(row.employees_id);
                url = "employees/saveCheck";
       		}
         });
		
		$(document).on("click", "#saveCheck", function(){
			$("#fm6").form("submit",{
                url: url,
                onSubmit: function(){
                    return $(this).form("validate");
                },
                success: function(result){
                   $("#dlg6").dialog("close");
                   $("#dg").datagrid("reload");
                }
            });
		});
		$.extend($.fn.validatebox.defaults.rules, {
			idCode:{  
                validator:function(value,param){  
                    return /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(value);  
                },  
                message: '请输入正确的身份证号'  
            }
		}); 
		
		$(document).on("click", "#bindingSave", function(){
			var row = $("#dg").datagrid("getSelected");
			var status = $("#fmbinding").form("validate");
			var mobileSelect = $("#mobileSelect").combobox("getValue");
			if (status) {
				layer.msg("正在绑定用户,请稍候...", {icon:16,shade:0.05,time:0});
	    		$.ajax({
	    			type: "POST",
	             	url: "employees/bindingUser",
	             	data:"employeeId="+row.employees_id+"&userId="+mobileSelect,
	             	dataType: "json",
	             	success: function(data){
	             		layer.closeAll();
	             		if (data.status) {
	             			$("#bindingDig").dialog("close");
	             			layer.msg("成功绑定该用户...");
	             			$("#dg").datagrid("reload");
	             		} else {
	             			layer.msg(data.message);
	             		}
	             	}
	    		});
			} else {
				return false;
			}
		});
    </script>
  </body>
</html>
